<!DOCTYPE html>
<html>
<head>
    <link rel="shortcut icon" href="https://phaser.io/favicon.ico"/>
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.15.1/dist/phaser-arcade-physics.min.js"></script>
</head>
<body>

    <script>
    var PIPE_START_X = 830;
    var PLAYER_X = 100;
    var PLAYER_Y = 200;
    var PIPE_SPEED = -100;
    var JUMP_SPEED = -150;
    var player;
    var pipeGrp;
    var pipes = [];
    var ground;
    var gameOver;
    var config = {
        type: Phaser.AUTO,
        width: 800,
        height: 600,
        physics: {
            default: 'arcade',
            arcade: {
                gravity: { y: 300 }
            }
        },
        scene: {
            preload: preload,
            create: create,
            update: update
        }
    };

    var game = new Phaser.Game(config);
    var myPhysics;
    var startText;
    var scoreText;
    var points = 0;
    var scoredPipe = false;

    function preload ()
    {
        this.load.setBaseURL('http://labs.phaser.io');

        this.load.image('sky', 'assets/skies/gradient30.png');
        this.load.image('player', 'assets/sprites/phaser-dude.png');
        this.load.image('pipe', 'assets/phaser3/bars.png');
        this.load.image('ground', 'assets/sprites/stripes800x32-bg.png');
    }

    function makePipe () {
        var rndDw = getRandomY();
        var pipeys = [rndDw - 570,rndDw];
        for (yp in pipeys) {
            var pipe = pipeGrp.create(PIPE_START_X, pipeys[yp], 'pipe');
            pipe.body.setAllowGravity(false);
            pipe.setBounce(0);
            pipe.setVelocityX(PIPE_SPEED);
            pipe.setScale(1,23);
            pipe.setCollideWorldBounds(false);
            pipes.push(pipe);
        }
    }

    function resetPipe (point) {
        var rndDw = getRandomY();
        var pipeys = [rndDw - 570,rndDw];
        for (r in pipes) {
            pipes[r].setPosition(PIPE_START_X, pipeys[r]);
            pipes[r].setVelocityX(PIPE_SPEED);
            pipes[r].setVelocityY(0);
        }
        scoredPipe = false;
        if (!point) {
            player.setPosition(PLAYER_X,PLAYER_Y);
            player.setVelocityX(0);
        }
    }

    function create ()
    {
        this.add.image(400, 300, 'sky');

        player = this.physics.add.image(PLAYER_X, PLAYER_Y, 'player');
        player.setCollideWorldBounds(true);

        pipeGrp = this.physics.add.group();
        makePipe();

        ground = this.physics.add.staticGroup();
        ground.create(400,600,'ground');

        this.physics.add.collider(player, ground, killPlayer, null, this);
        this.physics.add.collider(player, pipeGrp, killPlayer, null, this);

        this.input.keyboard.on('keydown',function(event){
            if (event.key === "ArrowUp") {
                player.setVelocityY(JUMP_SPEED);
            }            
            if (!gameOver || event.key === "Enter") {
                if (event.key === "Enter") {
                    resetPipe();
                    player.setTint(0xffffff);
                    scoreText.setText('score: 0');
                }
                startText.setText('');
                myPhysics.resume();
            }
        });

        scoreText = this.add.text(16, 16, 'score: 0', { fontSize: '24px', fill: '#fff' });
        startText = this.add.text(this.game.config.width/2 - 150, this.game.config.height/2, 'Hit any key to start', { fontSize: '24px', fill: '#fff' });

        this.physics.pause();
        myPhysics = this.physics;

    }

    function getRandomY () {
        return Math.floor(Math.random() * 450) + 350;
    }

    function update () {
        if (pipes[0].body.x < 40) {
            scorePoint();
        }
        if (pipes[0].body.x < -100) {
            resetPipe(true);
        }
    }

    function scorePoint (event) {
        if (!scoredPipe) {
            scoreText.setText('score: '+(++points));
            scoredPipe = true;
        }
    }

    function killPlayer () {
        player.setTint(0xff0000);
        this.physics.pause();
        gameOver = true;
        startText.setText('.... Game over !!');
        points = 0;
    }

    </script>

</body>
</html>